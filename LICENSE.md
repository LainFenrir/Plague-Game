State machine code is derived from GDquest  project https://github.com/GDQuest/godot-platformer-2d 